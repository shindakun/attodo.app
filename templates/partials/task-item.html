{{define "task-item.html"}}
<div class="task-item {{if .Completed}}completed{{end}}" id="task-{{.RKey}}">
    <div class="task-view">
        <h4>{{.Title}}</h4>
        {{if .Description}}
        <p>{{.Description}}</p>
        {{end}}
        <small>Created: {{formatDate .CreatedAt}}</small>
        {{if .CompletedAt}}
        <small> â€¢ Completed: {{formatDate .CompletedAt}}</small>
        {{end}}
        {{if .Lists}}
        <div style="margin-top: 0.5rem;">
            <small style="color: var(--pico-muted-color);">
                In lists:
                {{range $index, $list := .Lists}}
                    {{if $index}}, {{end}}<a href="/app/lists/view/{{$list.RKey}}" style="font-size: inherit;">{{$list.Name}}</a>
                {{end}}
            </small>
        </div>
        {{end}}
    </div>

    <div class="task-edit" style="display: none;">
        <form
            hx-patch="/app/tasks"
            hx-target="#task-{{.RKey}}"
            hx-swap="outerHTML"
        >
            <input type="hidden" name="rkey" value="{{.RKey}}">
            <label>
                Title
                <input type="text" name="title" value="{{.Title}}" required>
            </label>
            <label>
                Description
                <textarea name="description" rows="3">{{.Description}}</textarea>
            </label>
            <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                <button type="submit">Save</button>
                <button type="button" onclick="cancelEdit('{{.RKey}}')">Cancel</button>
            </div>
        </form>
    </div>

    <div class="task-actions">
        <button onclick="showAddToList('{{.RKey}}', '{{.URI}}')">
            Add to List
        </button>
        <button onclick="startEdit('{{.RKey}}')">
            Edit
        </button>
        <button
            hx-put="/app/tasks"
            hx-vals='{"rkey": "{{.RKey}}"}'
            hx-target="#task-{{.RKey}}"
            hx-swap="outerHTML"
            onclick="this.closest('.task-item').classList.add('task-removing')"
        >
            {{if .Completed}}Mark Incomplete{{else}}Mark Complete{{end}}
        </button>
        <button
            class="delete"
            hx-delete="/app/tasks?rkey={{.RKey}}"
            hx-target="#task-{{.RKey}}"
            hx-swap="outerHTML"
            hx-confirm="Are you sure you want to delete this task?"
            onclick="this.closest('.task-item').classList.add('task-removing')"
        >
            Delete
        </button>
    </div>
</div>
{{end}}
