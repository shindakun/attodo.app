{{define "task-item.html"}}
<div class="task-item {{if .Completed}}completed{{end}}" id="task-{{.RKey}}">
    <div class="task-view">
        <h4>{{.Title}}</h4>
        {{if .Description}}
        <p>{{.Description}}</p>
        {{end}}

        {{if .Tags}}
        <div class="task-tags" style="margin-top: 0.5rem;">
            {{range .Tags}}
            <span class="tag" onclick="filterByTag('{{.}}')">{{.}}</span>
            {{end}}
        </div>
        {{end}}

        <small>Created: <time class="local-time" datetime="{{formatDate .CreatedAt}}">{{formatDate .CreatedAt}}</time></small>
        {{if .CompletedAt}}
        <small> â€¢ Completed: <time class="local-time" datetime="{{formatDate .CompletedAt}}">{{formatDate .CompletedAt}}</time></small>
        {{end}}
        {{if .Lists}}
        <div style="margin-top: 0.5rem;">
            <small style="color: var(--pico-muted-color);">
                In lists:
                {{range $index, $list := .Lists}}
                    {{if $index}}, {{end}}<a href="/app/lists/view/{{$list.RKey}}" style="font-size: inherit;">{{$list.Name}}</a>
                {{end}}
            </small>
        </div>
        {{end}}
    </div>

    <div class="task-edit" style="display: none;">
        <form
            hx-patch="/app/tasks"
            hx-target="#task-{{.RKey}}"
            hx-swap="outerHTML swap:500ms"
        >
            <input type="hidden" name="rkey" value="{{.RKey}}">
            <label>
                Title
                <input type="text" name="title" value="{{.Title}}" required>
            </label>
            <label>
                Description
                <textarea name="description" rows="3">{{.Description}}</textarea>
            </label>

            <label>
                Tags (comma-separated)
                <input type="text" name="tags" id="tags-{{.RKey}}" value="{{joinTags .Tags}}" placeholder="work, urgent, personal">
                <small>Separate tags with commas</small>
            </label>

            <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                <button type="submit">Save</button>
                <button type="button" onclick="cancelEdit('{{.RKey}}')">Cancel</button>
            </div>
        </form>
    </div>

    <div class="task-actions">
        <button onclick="showAddToList('{{.RKey}}', '{{.URI}}')">
            Add to List
        </button>
        <button onclick="startEdit('{{.RKey}}')">
            Edit
        </button>
        <button
            hx-put="/app/tasks"
            hx-vals='{"rkey": "{{.RKey}}"}'
            hx-target="#task-{{.RKey}}"
            hx-swap="outerHTML swap:500ms"
        >
            {{if .Completed}}Mark Incomplete{{else}}Mark Complete{{end}}
        </button>
        <button
            class="delete"
            hx-delete="/app/tasks?rkey={{.RKey}}"
            hx-target="#task-{{.RKey}}"
            hx-swap="outerHTML swap:500ms"
            hx-confirm="Are you sure you want to delete this task?"
        >
            Delete
        </button>
    </div>
</div>
{{end}}
